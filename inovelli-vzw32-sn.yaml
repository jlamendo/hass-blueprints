# yamllint disable-line rule:line-length
---
blueprint:
  name: Inovelli Red Series VZW32-SN Red Series Switch (ZWave-JS)
  description: Create automations based on scenes for the Inovelli Red Series VZW32-SN Switch.
  domain: automation
  input:
    zwave_device:
      name: Inovelli Switch
      description: List of available Inovelli VZW32-SN switches.
      selector:
        device:
          integration: zwave_js
          manufacturer: Inovelli
          model: VZW32-SN
          multiple: false
    motion_detected:
      name: Motion Detected
      description: Action to run when motion is detected in any reporting zone.
      default: []
      selector:
        action: {}
    motion_cleared:
      name: Motion Cleared
      description: Action to run when motion is cleared after the delay.
      default: []
      selector:
        action: {}
    motion_clear_delay:
      name: Motion Clear Delay (minutes)
      description: Minutes motion must be clear before the cleared action runs.
      default: 0
      selector:
        number:
          min: 0
          max: 120
          step: 1
          unit_of_measurement: min
    config_button:
      name: Config Press 1x
      description: Action to run, when the config button is pressed one time.
      default: []
      selector:
        action: {}
    button_a:
      name: Up/On Press 1x
      description: Action to run, when the Up button is pressed one time.
      default: []
      selector:
        action: {}
    button_b:
      name: Down/Off Press 1x
      description: Action to run, when the Down button is pressed one time.
      default: []
      selector:
        action: {}
    config_button2:
      name: Config Press 2x
      description: Action to run, when the config button is pressed two times.
      default: []
      selector:
        action: {}
    button_a2:
      name: Up/On Press 2x
      description: Action to run, when the Up button is pressed two times.
      default: []
      selector:
        action: {}
    button_b2:
      name: Down/Off Press 2x
      description: Action to run, when the Down button is pressed two times.
      default: []
      selector:
        action: {}
    config_button3:
      name: Config Press 3x
      description: Action to run, when the config button is pressed three times.
      default: []
      selector:
        action: {}
    button_a3:
      name: Up/On Press 3x
      description: Action to run, when the up button is pressed three times.
      default: []
      selector:
        action: {}
    button_b3:
      name: Down/Off Press 3x
      description: Action to run, when the Down button is pressed three times.
      default: []
      selector:
        action: {}
    config_button4:
      name: Config Press 4x
      description: Action to run, when the config button is pressed four times.
      default: []
      selector:
        action: {}
    button_a4:
      name: Up/On Press 4x
      description: Action to run, when the Up button is pressed four times.
      default: []
      selector:
        action: {}
    button_b4:
      name: Down/Off Press 4x
      description: Action to run, when the Down button is pressed four times.
      default: []
      selector:
        action: {}
    config_button5:
      name: Config Press 5x
      description: Action to run, when the config button is pressed five times.
      default: []
      selector:
        action: {}
    button_a5:
      name: Up/On Press 5x
      description: Action to run, when the Up button is pressed five times.
      default: []
      selector:
        action: {}
    button_b5:
      name: Down/Off Press 5x
      description: Action to run, when the Down button is pressed five times.
      default: []
      selector:
        action: {}
    config_button_held:
      name: Config Press Held Down
      description: Action to run, when the config button is pressed and held.
      default: []
      selector:
        action: {}
    button_a_held:
      name: Up/On Press Held Down
      description: Action to run, when the Up button is pressed and held.
      default: []
      selector:
        action: {}
    button_b_held:
      name: Down/Off Press Held Down
      description: Action to run, when the Down button is pressed and held.
      default: []
      selector:
        action: {}
    config_button_released:
      name: Config Press Hold Release
      description: Action to run, when the config button is released after being held.
      default: []
      selector:
        action: {}
    button_a_released:
      name: Up/On Press Hold Release
      description: Action to run, when the Up button is released after being held.
      default: []
      selector:
        action: {}
    button_b_released:
      name: Down/Off Press Hold Release
      description: Action to run, when the Down button is released after being held.
      default: []
      selector:
        action: {}
    aux_config_button:
      name: Aux Config Press 1x
      description: Action to run, when the config button is pressed one time on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a:
      name: Aux Up/On Press 1x
      description: Action to run, when the Up button is pressed one time on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b:
      name: Aux Down/Off Press 1x
      description: Action to run, when the Down button is pressed one time on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button2:
      name: Aux Config Press 2x
      description: Action to run, when the config button is pressed two times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a2:
      name: Aux Up/On Press 2x
      description: Action to run, when the Up button is pressed two times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b2:
      name: Aux Down/Off Press 2x
      description: Action to run, when the Down button is pressed two times on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button3:
      name: Aux Config Press 3x
      description: Action to run, when the config button is pressed three times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a3:
      name: Aux Up/On Press 3x
      description: Action to run, when the up button is pressed three times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b3:
      name: Aux Down/Off Press 3x
      description: Action to run, when the Down button is pressed three times on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button4:
      name: Aux Config Press 4x
      description: Action to run, when the config button is pressed four times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a4:
      name: Aux Up/On Press 4x
      description: Action to run, when the Up button is pressed four times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b4:
      name: Aux Down/Off Press 4x
      description: Action to run, when the Down button is pressed four times on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button5:
      name: Aux Config Press 5x
      description: Action to run, when the config button is pressed five times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a5:
      name: Aux Up/On Press 5x
      description: Action to run, when the Up button is pressed five times on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b5:
      name: Aux Down/Off Press 5x
      description: Action to run, when the Down button is pressed five times on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button_held:
      name: Aux Config Press Held Down
      description: Action to run, when the config button is pressed and held on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a_held:
      name: Aux Up/On Press Held Down
      description: Action to run, when the Up button is pressed and held on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b_held:
      name: Aux Down/Off Press Held Down
      description: Action to run, when the Down button is pressed and held on the aux switch.
      default: []
      selector:
        action: {}
    aux_config_button_released:
      name: Aux Config Press Hold Release
      description: Action to run, when the config button is released after being held on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_a_released:
      name: Aux Up/On Press Hold Release
      description: Action to run, when the Up button is released after being held on the aux switch.
      default: []
      selector:
        action: {}
    aux_button_b_released:
      name: Aux Down/Off Press Hold Release
      description: Action to run, when the Down button is released after being held on the aux switch.
      default: []
      selector:
        action: {}
  source_url: https://github.com/jlamendo/hass-blueprints/blob/main/inovelli-vzw32-sn-red-series-switch.yaml
mode: single
max_exceeded: silent
variables:
  device_id: !input 'zwave_device'
triggers:
  - trigger: event
    event_type: zwave_js_value_notification
  - trigger: device
    device_id: !input zwave_device
    domain: zwave_js
    type: zwave_js.value_updated.config_parameter
    property: 116
    property_key: 255
    endpoint: 0
    command_class: 112
    subtype: >-
      116[0xff] on endpoint 0 (mmWave Person in the Reporting Area 1 (Read Only)) on
      endpoint 0
  - trigger: device
    device_id: !input zwave_device
    domain: zwave_js
    type: zwave_js.value_updated.config_parameter
    property: 116
    property_key: 65280
    endpoint: 0
    command_class: 112
    subtype: >-
      116[0xff00] on endpoint 0 (mmWave Person in the Reporting Area 2 (Read Only))
      on endpoint 0
  - trigger: device
    device_id: !input zwave_device
    domain: zwave_js
    type: zwave_js.value_updated.config_parameter
    property: 116
    property_key: 16711680
    endpoint: 0
    command_class: 112
    subtype: >-
      116[0xff0000] on endpoint 0 (mmWave Person in the Reporting Area 3 (Read
      Only)) on endpoint 0
  - trigger: device
    device_id: !input zwave_device
    domain: zwave_js
    type: zwave_js.value_updated.config_parameter
    property: 116
    property_key: 4278190080
    endpoint: 0
    command_class: 112
    subtype: >-
      116[0xff000000] on endpoint 0 (mmWave Person in the Reporting Area 4 (Read
      Only)) on endpoint 0
condition: >-
  {{ (trigger.platform == 'event' and trigger.event.data.device_id == device_id)
     or trigger.platform == 'device' }}
actions:
  - variables:
      button_id: '{{ trigger.event.data.property_key_name if trigger.platform == "event" else "" }}'
      press_count: '{{ trigger.event.data.value if trigger.platform == "event" else "" }}'
      motion_entities: >-
        {{ expand(device_entities(device_id))
           | selectattr('domain', 'eq', 'binary_sensor')
           | selectattr('attributes.device_class', 'eq', 'motion')
           | map(attribute='entity_id')
           | list }}
      motion_on_count: >-
        {{ expand(motion_entities)
           | selectattr('state', 'eq', 'on')
           | list
           | count }}
      motion_all_off: '{{ motion_on_count == 0 }}'
  - choose:
      - conditions: '{{ trigger.platform == "device" and (trigger.value | int(0)) > 0 }}'
        sequence: !input 'motion_detected'
      - conditions: '{{ trigger.platform == "device" and (trigger.value | int(0)) == 0 }}'
        sequence:
          - if:
              - condition: template
                value_template: '{{ motion_all_off }}'
            then:
              - delay:
                  minutes: !input motion_clear_delay
              - if:
                  - condition: template
                    value_template: '{{ motion_all_off }}'
                then: !input 'motion_cleared'
      - conditions: '{{ button_id == "003" and press_count == "KeyPressed" }}'
        sequence: !input 'config_button'
      - conditions: '{{ button_id == "002" and press_count == "KeyPressed" }}'
        sequence: !input 'button_a'
      - conditions: '{{ button_id == "001" and press_count == "KeyPressed" }}'
        sequence: !input 'button_b'
      - conditions: '{{ button_id == "003" and press_count == "KeyPressed2x" }}'
        sequence: !input 'config_button2'
      - conditions: '{{ button_id == "002" and press_count == "KeyPressed2x" }}'
        sequence: !input 'button_a2'
      - conditions: '{{ button_id == "001" and press_count == "KeyPressed2x" }}'
        sequence: !input 'button_b2'
      - conditions: '{{ button_id == "003" and press_count == "KeyPressed3x" }}'
        sequence: !input 'config_button3'
      - conditions: '{{ button_id == "002" and press_count == "KeyPressed3x" }}'
        sequence: !input 'button_a3'
      - conditions: '{{ button_id == "001" and press_count == "KeyPressed3x" }}'
        sequence: !input 'button_b3'
      - conditions: '{{ button_id == "003" and press_count == "KeyPressed4x" }}'
        sequence: !input 'config_button4'
      - conditions: '{{ button_id == "002" and press_count == "KeyPressed4x" }}'
        sequence: !input 'button_a4'
      - conditions: '{{ button_id == "001" and press_count == "KeyPressed4x" }}'
        sequence: !input 'button_b4'
      - conditions: '{{ button_id == "003" and press_count == "KeyPressed5x" }}'
        sequence: !input 'config_button5'
      - conditions: '{{ button_id == "002" and press_count == "KeyPressed5x" }}'
        sequence: !input 'button_a5'
      - conditions: '{{ button_id == "001" and press_count == "KeyPressed5x" }}'
        sequence: !input 'button_b5'
      - conditions: '{{ button_id == "003" and press_count == "KeyHeldDown" }}'
        sequence: !input 'config_button_held'
      - conditions: '{{ button_id == "002" and press_count == "KeyHeldDown" }}'
        sequence: !input 'button_a_held'
      - conditions: '{{ button_id == "001" and press_count == "KeyHeldDown" }}'
        sequence: !input 'button_b_held'
      - conditions: '{{ button_id == "003" and press_count == "KeyReleased" }}'
        sequence: !input 'config_button_released'
      - conditions: '{{ button_id == "002" and press_count == "KeyReleased" }}'
        sequence: !input 'button_a_released'
      - conditions: '{{ button_id == "001" and press_count == "KeyReleased" }}'
        sequence: !input 'button_b_released'
      - conditions: '{{ button_id == "006" and press_count == "KeyPressed" }}'
        sequence: !input 'aux_config_button'
      - conditions: '{{ button_id == "005" and press_count == "KeyPressed" }}'
        sequence: !input 'aux_button_a'
      - conditions: '{{ button_id == "004" and press_count == "KeyPressed" }}'
        sequence: !input 'aux_button_b'
      - conditions: '{{ button_id == "006" and press_count == "KeyPressed2x" }}'
        sequence: !input 'aux_config_button2'
      - conditions: '{{ button_id == "005" and press_count == "KeyPressed2x" }}'
        sequence: !input 'aux_button_a2'
      - conditions: '{{ button_id == "004" and press_count == "KeyPressed2x" }}'
        sequence: !input 'aux_button_b2'
      - conditions: '{{ button_id == "006" and press_count == "KeyPressed3x" }}'
        sequence: !input 'aux_config_button3'
      - conditions: '{{ button_id == "005" and press_count == "KeyPressed3x" }}'
        sequence: !input 'aux_button_a3'
      - conditions: '{{ button_id == "004" and press_count == "KeyPressed3x" }}'
        sequence: !input 'aux_button_b3'
      - conditions: '{{ button_id == "006" and press_count == "KeyPressed4x" }}'
        sequence: !input 'aux_config_button4'
      - conditions: '{{ button_id == "005" and press_count == "KeyPressed4x" }}'
        sequence: !input 'aux_button_a4'
      - conditions: '{{ button_id == "004" and press_count == "KeyPressed4x" }}'
        sequence: !input 'aux_button_b4'
      - conditions: '{{ button_id == "006" and press_count == "KeyPressed5x" }}'
        sequence: !input 'aux_config_button5'
      - conditions: '{{ button_id == "005" and press_count == "KeyPressed5x" }}'
        sequence: !input 'aux_button_a5'
      - conditions: '{{ button_id == "004" and press_count == "KeyPressed5x" }}'
        sequence: !input 'aux_button_b5'
      - conditions: '{{ button_id == "006" and press_count == "KeyHeldDown" }}'
        sequence: !input 'aux_config_button_held'
      - conditions: '{{ button_id == "005" and press_count == "KeyHeldDown" }}'
        sequence: !input 'aux_button_a_held'
      - conditions: '{{ button_id == "004" and press_count == "KeyHeldDown" }}'
        sequence: !input 'aux_button_b_held'
      - conditions: '{{ button_id == "006" and press_count == "KeyReleased" }}'
        sequence: !input 'aux_config_button_released'
      - conditions: '{{ button_id == "005" and press_count == "KeyReleased" }}'
        sequence: !input 'aux_button_a_released'
      - conditions: '{{ button_id == "004" and press_count == "KeyReleased" }}'
        sequence: !input 'aux_button_b_released'
